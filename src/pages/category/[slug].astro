---
import type { Category } from '../../../type'
import MainPosts from '../../components/MainPosts.astro'
import PopularPosts from '../../components/PopularPosts.astro'
import SideBar from '../../components/SideBar.astro'
import Layout from '../../layouts/Layout.astro'
import { client } from '../../lib/newt/client'

export async function getStaticPaths() {
  const categoryData = await client.getContents({
    appUid: import.meta.env.PUBLIC_NEWT_APP_UID,
    modelUid: import.meta.env.PUBLIC_NEWT_MODEL_CATEGORY,
    // query: {
    //   slug: 'column',
    // },
  })
  // console.log(categoryData)
  const categoryContents = categoryData.items
  // console.log(categoryContents)
  return [
    // paginate(postsContents, { pageSize: 2 }),
    categoryContents.map((categoryContent) => ({
      params: {
        slug: categoryContent.slug,
      },
      props: {
        name: categoryContent.name,
      },
    })),
  ]
}

const { name, page } = Astro.props
const { slug } = Astro.params

console.log(page)

const postsData = await client.getContents({
  appUid: import.meta.env.PUBLIC_NEWT_APP_UID,
  modelUid: import.meta.env.PUBLIC_NEWT_MODEL_POST,
})
// console.log(postsData.items)
const postsContents = postsData.items.filter(
  (item) => item.category.slug === slug
)

const kvTitleEn = 'category'
const kvTitleJa = name
const kvProps = { kvTitleEn, kvTitleJa }
---

<Layout title="category">
  <main class="container">
    <div class="main">
      <MainPosts kvProps={kvProps} postsContents={postsContents} />
      <PopularPosts />
    </div>
    <SideBar />
  </main>
</Layout>

<style lang="scss">
  .container {
    display: grid;
    grid-template-columns: 1fr 28rem;
    gap: 7.5rem;
    width: 126.5rem;
    // margin: 8rem auto 0;
    margin: 0 auto;
  }
</style>
